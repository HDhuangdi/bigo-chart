var BigoChart=function(){"use strict";function t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function i(t,i){return t(i={exports:{}},i.exports),i.exports}var e=i((function(t){t.exports=function(t,i){(null==i||i>t.length)&&(i=t.length);for(var e=0,a=new Array(i);e<i;e++)a[e]=t[e];return a},t.exports.default=t.exports,t.exports.__esModule=!0}));t(e);var a=i((function(t){t.exports=function(t){if(Array.isArray(t))return e(t)},t.exports.default=t.exports,t.exports.__esModule=!0}));t(a);var r=i((function(t){t.exports=function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)},t.exports.default=t.exports,t.exports.__esModule=!0}));t(r);var n=i((function(t){t.exports=function(t,i){if(t){if("string"==typeof t)return e(t,i);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?e(t,i):void 0}},t.exports.default=t.exports,t.exports.__esModule=!0}));t(n);var o=i((function(t){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.default=t.exports,t.exports.__esModule=!0}));t(o);var s=t(i((function(t){t.exports=function(t){return a(t)||r(t)||n(t)||o()},t.exports.default=t.exports,t.exports.__esModule=!0}))),h=t(i((function(t){t.exports=function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")},t.exports.default=t.exports,t.exports.__esModule=!0}))),l=t(i((function(t){function i(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}t.exports=function(t,e,a){return e&&i(t.prototype,e),a&&i(t,a),t},t.exports.default=t.exports,t.exports.__esModule=!0}))),c=t(i((function(t){t.exports=function(t,i,e){return i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t},t.exports.default=t.exports,t.exports.__esModule=!0})));function d(t,i){if(0===t)return"0";if(!t)return"--";var e=t.toString().split(".")[1],a=Number(t.toString().split(".")[0]);return e=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1?arguments[1]:void 0;if(void 0!==i)if(0!==i)if(t)if(t.length>i)t=t.slice(0,i);else for(var e=0,a=i-t.length;e<a;e++)t+="0";else for(var r=0;r<i;r++)t+="0";else 0===i&&(t="");return t&&(t="."+t),t}(e,i),-1!==t.toString().indexOf("-")&&Math.abs(parseFloat(a))<=0?"-"+"".concat(a).concat(e):"".concat(a).concat(e)}function u(t,i){var e,a={"Y+":i.getFullYear().toString(),"m+":(i.getMonth()+1).toString(),"d+":i.getDate().toString(),"H+":i.getHours().toString(),"M+":i.getMinutes().toString(),"S+":i.getSeconds().toString()};for(var r in a)(e=new RegExp("("+r+")").exec(t))&&(t=t.replace(e[1],1===e[1].length?a[r]:a[r].padStart(e[1].length,"0")));return t}function v(t){throw new Error("[bigo-chart warn]:"+t)}var f=function(){function t(){h(this,t),c(this,"view",void 0),c(this,"service",void 0),c(this,"chart",void 0),c(this,"isMouseDown",!1),c(this,"prevMousePosition",{}),c(this,"nowMousePosition",{}),c(this,"dragCoefficient",1e3)}return l(t,[{key:"inject",value:function(t,i,e){this.view=t,this.service=i,this.chart=e}},{key:"registerMouseEvents",value:function(){var t=this.view;t.canvas.addEventListener("mousedown",this.onMouseDown.bind(this)),t.canvas.addEventListener("mousemove",this.onMouseMove.bind(this)),t.canvas.addEventListener("mouseup",this.onMouseUp.bind(this)),t.canvas.addEventListener("mousewheel",this.onMouseWeel.bind(this))}},{key:"onMouseDown",value:function(t){this.isMouseDown=!0,this.prevMousePosition={x:t.offsetX,y:t.offsetY}}},{key:"onMouseMove",value:function(t){var i=this.chart,e=this.view,a=this.service,r=t.offsetX,n=t.offsetY;if(this.nowMousePosition={x:r,y:n},!this.isMouseDown)return e.draw();a.dataZoom.user=!0;var o=this.prevMousePosition.x-this.nowMousePosition.x,s=i.bars[0].time,h=a.dataZoom.xAxisStartValue+this.dragCoefficient*o,l=a.dataZoom.xAxisEndValue+this.dragCoefficient*o;h-100*i.tickerUnit<=s?a.loadMoreData():(this.dragCoefficient=e.xAxisUnitsVisiable/i.tickerUnit*40,a.updateDataZoom(h,l),e.draw(),this.prevMousePosition={x:r,y:n})}},{key:"onMouseUp",value:function(){this.isMouseDown=!1}},{key:"onMouseWeel",value:function(t){t.preventDefault();var i,e,a,r=this.view,n=this.service;if(n.dataZoom.user=!0,t.wheelDelta?(i=t.wheelDelta/120,window.opera&&(i=-i)):t.detail&&(i=-t.detail/3),i>=0){if(n.dataZoom.data.length<=20)return;e=n.dataZoom.xAxisStartValue+12e4,a=n.dataZoom.xAxisEndValue-12e4}else{if(n.dataZoom.data.length>=200)return;e=n.dataZoom.xAxisStartValue-12e4,a=n.dataZoom.xAxisEndValue+12e4}n.updateDataZoom(e,a),r.draw()}}]),t}(),p=i((function(t){t.exports=function(t){if(Array.isArray(t))return t},t.exports.default=t.exports,t.exports.__esModule=!0}));t(p);var m=i((function(t){t.exports=function(t,i){var e=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null!=e){var a,r,n=[],o=!0,s=!1;try{for(e=e.call(t);!(o=(a=e.next()).done)&&(n.push(a.value),!i||n.length!==i);o=!0);}catch(t){s=!0,r=t}finally{try{o||null==e.return||e.return()}finally{if(s)throw r}}return n}},t.exports.default=t.exports,t.exports.__esModule=!0}));t(m);var g=i((function(t){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.default=t.exports,t.exports.__esModule=!0}));t(g);var x=t(i((function(t){t.exports=function(t,i){return p(t)||m(t,i)||n(t,i)||g()},t.exports.default=t.exports,t.exports.__esModule=!0}))),y=t(i((function(t){function i(t,i,e,a,r,n,o){try{var s=t[n](o),h=s.value}catch(t){return void e(t)}s.done?i(h):Promise.resolve(h).then(a,r)}t.exports=function(t){return function(){var e=this,a=arguments;return new Promise((function(r,n){var o=t.apply(e,a);function s(t){i(o,r,n,s,h,"next",t)}function h(t){i(o,r,n,s,h,"throw",t)}s(void 0)}))}},t.exports.default=t.exports,t.exports.__esModule=!0}))),w=i((function(t){var i=function(t){var i,e=Object.prototype,a=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function h(t,i,e){return Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[i]}try{h({},"")}catch(t){h=function(t,i,e){return t[i]=e}}function l(t,i,e,a){var r=i&&i.prototype instanceof m?i:m,n=Object.create(r.prototype),o=new D(a||[]);return n._invoke=function(t,i,e){var a=d;return function(r,n){if(a===v)throw new Error("Generator is already running");if(a===f){if("throw"===r)throw n;return T()}for(e.method=r,e.arg=n;;){var o=e.delegate;if(o){var s=M(o,e);if(s){if(s===p)continue;return s}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if(a===d)throw a=f,e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);a=v;var h=c(t,i,e);if("normal"===h.type){if(a=e.done?f:u,h.arg===p)continue;return{value:h.arg,done:e.done}}"throw"===h.type&&(a=f,e.method="throw",e.arg=h.arg)}}}(t,e,o),n}function c(t,i,e){try{return{type:"normal",arg:t.call(i,e)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var d="suspendedStart",u="suspendedYield",v="executing",f="completed",p={};function m(){}function g(){}function x(){}var y={};y[n]=function(){return this};var w=Object.getPrototypeOf,_=w&&w(w(k([])));_&&_!==e&&a.call(_,n)&&(y=_);var A=x.prototype=m.prototype=Object.create(y);function b(t){["next","throw","return"].forEach((function(i){h(t,i,(function(t){return this._invoke(i,t)}))}))}function E(t,i){function e(r,n,o,s){var h=c(t[r],t,n);if("throw"!==h.type){var l=h.arg,d=l.value;return d&&"object"==typeof d&&a.call(d,"__await")?i.resolve(d.__await).then((function(t){e("next",t,o,s)}),(function(t){e("throw",t,o,s)})):i.resolve(d).then((function(t){l.value=t,o(l)}),(function(t){return e("throw",t,o,s)}))}s(h.arg)}var r;this._invoke=function(t,a){function n(){return new i((function(i,r){e(t,a,i,r)}))}return r=r?r.then(n,n):n()}}function M(t,e){var a=t.iterator[e.method];if(a===i){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=i,M(t,e),"throw"===e.method))return p;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var r=c(a,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,p;var n=r.arg;return n?n.done?(e[t.resultName]=n.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=i),e.delegate=null,p):n:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function L(t){var i={tryLoc:t[0]};1 in t&&(i.catchLoc=t[1]),2 in t&&(i.finallyLoc=t[2],i.afterLoc=t[3]),this.tryEntries.push(i)}function U(t){var i=t.completion||{};i.type="normal",delete i.arg,t.completion=i}function D(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function k(t){if(t){var e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(a.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=i,e.done=!0,e};return o.next=o}}return{next:T}}function T(){return{value:i,done:!0}}return g.prototype=A.constructor=x,x.constructor=g,g.displayName=h(x,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var i="function"==typeof t&&t.constructor;return!!i&&(i===g||"GeneratorFunction"===(i.displayName||i.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,h(t,s,"GeneratorFunction")),t.prototype=Object.create(A),t},t.awrap=function(t){return{__await:t}},b(E.prototype),E.prototype[o]=function(){return this},t.AsyncIterator=E,t.async=function(i,e,a,r,n){void 0===n&&(n=Promise);var o=new E(l(i,e,a,r),n);return t.isGeneratorFunction(e)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},b(A),h(A,s,"Generator"),A[n]=function(){return this},A.toString=function(){return"[object Generator]"},t.keys=function(t){var i=[];for(var e in t)i.push(e);return i.reverse(),function e(){for(;i.length;){var a=i.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},t.values=k,D.prototype={constructor:D,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=i,this.done=!1,this.delegate=null,this.method="next",this.arg=i,this.tryEntries.forEach(U),!t)for(var e in this)"t"===e.charAt(0)&&a.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=i)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(a,r){return s.type="throw",s.arg=t,e.next=a,r&&(e.method="next",e.arg=i),!!r}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var h=a.call(o,"catchLoc"),l=a.call(o,"finallyLoc");if(h&&l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(h){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,i){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var n=r;break}}n&&("break"===t||"continue"===t)&&n.tryLoc<=i&&i<=n.finallyLoc&&(n=null);var o=n?n.completion:{};return o.type=t,o.arg=i,n?(this.method="next",this.next=n.finallyLoc,p):this.complete(o)},complete:function(t,i){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&i&&(this.next=i),p},finish:function(t){for(var i=this.tryEntries.length-1;i>=0;--i){var e=this.tryEntries[i];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),U(e),p}},catch:function(t){for(var i=this.tryEntries.length-1;i>=0;--i){var e=this.tryEntries[i];if(e.tryLoc===t){var a=e.completion;if("throw"===a.type){var r=a.arg;U(e)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,a){return this.delegate={iterator:k(t),resultName:e,nextLoc:a},"next"===this.method&&(this.arg=i),p}},t}(t.exports);try{regeneratorRuntime=i}catch(t){Function("r","regeneratorRuntime = r")(i)}})),_=function(){function t(){h(this,t),c(this,"view",void 0),c(this,"controller",void 0),c(this,"chart",void 0),c(this,"unitToXAxisPx",0),c(this,"candleUnitToYAxisPx",0),c(this,"volumeUnitToYAxisPx",0),c(this,"highestVolume",void 0),c(this,"dataZoom",{}),c(this,"loadMorePending",void 0),c(this,"hasMoreData",!0),c(this,"yAxisBuffer",.1)}var i;return l(t,[{key:"inject",value:function(t,i,e){this.view=t,this.controller=i,this.chart=e}},{key:"calcUnitToXAxisPx",value:function(){var t=this.view;this.unitToXAxisPx=t.xAxisUnitsVisiable/t.chartWidth}},{key:"calcUnitToYAxisPx",value:function(){var t=this.view;this.candleUnitToYAxisPx=(this.dataZoom.klineYAxisEndValue-this.dataZoom.klineYAxisStartValue)/t.klineChartHeight,this.volumeUnitToYAxisPx=(this.dataZoom.volumeYAxisEndValue-this.dataZoom.volumeYAxisStartValue)/t.volumeChartHeight}},{key:"calcXAxisCoordinate",value:function(){for(var t=this,i=this.chart,e=Math.floor(this.dataZoom.data.length/8),a=[],r=0;r<i.bars.length;r+=e)a.push({time:i.bars[r].time,value:0});return a.map((function(i){return{x:t.mapDataToCoordinate(i.time,i.value).x,y:0,time:i.time}}))}},{key:"calcYAxisCoordinate",value:function(){var t,i,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"candle",a=this.view,r=this.highestVolume;"candle"===e?(i=a.chartYAxisUnitsVisiable,t=(this.dataZoom.klineYAxisEndValue-this.dataZoom.klineYAxisStartValue)/(a.chartYAxisUnitsVisiable-1)):(i=a.volumeYAxisUnitsVisiable,t=(r-this.dataZoom.volumeYAxisStartValue)/(a.volumeYAxisUnitsVisiable-1));for(var n=[],o=0;o<i;o++){var s=void 0;s="candle"===e?this.dataZoom.klineYAxisStartValue+o*t:this.dataZoom.volumeYAxisStartValue+o*t;var h=this.mapDataToCoordinate(0,s,e);n.push({x:a.padding.left+a.chartWidth,y:h.y,value:s})}return n}},{key:"calcPadding",value:function(t){var i=this.chart,e=this.view,a=i.canvasUtils.getTextWidthAndHeight(e.axisLabelSize*e.dpr,"sans-serif",d(Math.max.apply(Math,s(t.map((function(t){return t.volume})))),i.volumeDigitNumber)).width;e.padding.top=15*e.dpr,e.padding.bottom=20*e.dpr,e.padding.left=15*e.dpr,e.padding.right=a}},{key:"updateDataZoom",value:function(t,i){var e=this.chart,a=e.bars[e.bars.length-1].time,r=e.bars[0].time;a<t||r>i||(this.dataZoom.xAxisStartValue=t,this.dataZoom.xAxisEndValue=i)}},{key:"calcDataZoom",value:function(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"update",e=this.chart,a=this.view;if("init"===i){var r=e.bars[e.bars.length-1].time+3*e.tickerUnit,n=r-a.xAxisUnitsVisiable;this.updateDataZoom(n,r)}else"update"===i&&(a.xAxisUnitsVisiable=this.dataZoom.xAxisEndValue-this.dataZoom.xAxisStartValue);this.dataZoom.data=e.bars.filter((function(i){return i.time<=t.dataZoom.xAxisEndValue&&i.time>=t.dataZoom.xAxisStartValue})),this.dataZoom.realData=e.bars.filter((function(i){return i.time<=t.dataZoom.xAxisEndValue+e.tickerUnit&&i.time>=t.dataZoom.xAxisStartValue-e.tickerUnit}));var o=Array.prototype.concat([],this.dataZoom.realData).sort((function(t,i){return i.high-t.high})),h=o[0].high;o.sort((function(t,i){return t.low-i.low}));var l=o[0].low;this.dataZoom.klineYAxisEndValue=h+(h-l)*this.yAxisBuffer,this.dataZoom.klineYAxisStartValue=l-(h-l)*this.yAxisBuffer,this.highestVolume=Math.max.apply(Math,s(o.map((function(t){return t.volume})))),this.dataZoom.volumeYAxisEndValue=this.highestVolume+this.highestVolume*this.yAxisBuffer,this.dataZoom.volumeYAxisStartValue=0}},{key:"calcMAPoints",value:function(){var t=this.chart;this.calcMAList(),t.MAOptions.forEach((function(i,e,a){for(var r,n=i.interval,o=[],s=[],h=0;h<t.MAData.length;h++){var l={value:t.MAData[h].close,time:t.MAData[h].time};s.push(l),h>=n-1&&(o.push({value:1*(r=s.map((function(t){return t.value})),r.reduce((function(t,i){return t+i}),0)/r.length).toFixed(t.priceDigitNumber),time:l.time}),s.shift())}a[e].points=o}))}},{key:"calcMAList",value:function(){var t=this,i=this.chart;i.MAData=i.bars.filter((function(e){return e.time<=t.dataZoom.xAxisEndValue+i.maxMAInterval*i.tickerUnit&&e.time>=t.dataZoom.xAxisStartValue-i.maxMAInterval*i.tickerUnit}))}},{key:"formatTickerData",value:function(t){t.status=t.close>=t.open?"up":"down",t.amplitude=(100*(t.high-t.low)/t.low).toFixed(2)+"%",t.change=(100*(t.close-t.high)/t.low).toFixed(2)+"%"}},{key:"loadMoreData",value:(i=y(w.mark((function t(){var i,e,a,r;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=this.chart,e=this.view,!this.loadMorePending&&this.hasMoreData){t.next=3;break}return t.abrupt("return");case 3:if(a=i.bars[0].time,!i.options.loadMore){t.next=18;break}return this.loadMorePending=!0,t.next=8,i.options.loadMore(a);case 8:if(r=t.sent,this.loadMorePending=!1,r){t.next=13;break}return this.hasMoreData=!1,t.abrupt("return");case 13:r.sort((function(t,i){return t.time-i.time})),r[r.length-1].time.time===a.time&&r.splice(r.length-1,1),i.bars=r.concat(i.bars),e.draw();case 18:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"mapDataToCoordinate",value:function(t,i){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"candle",a=this.view,r={x:0,y:0};if(r.x=a.padding.left+1*((t-this.dataZoom.xAxisStartValue)/this.unitToXAxisPx).toFixed(1),"candle"===e){var n=1*((i-this.dataZoom.klineYAxisStartValue)/this.candleUnitToYAxisPx).toFixed(1);r.y=a.padding.top+a.klineChartHeight-n}else{var o=1*((i-this.dataZoom.volumeYAxisStartValue)/this.volumeUnitToYAxisPx).toFixed(1);r.y=a.padding.top+a.chartHeight-o}return r}},{key:"mapCoordinateToData",value:function(t,i){var e=this.chart,a=this.view,r={time:0,value:0,type:""};r.time=Math.floor(this.dataZoom.xAxisStartValue+t*this.unitToXAxisPx);var n=a.klineChartHeight-i;return n<0?(r.type="volume",n=a.chartHeight-i,r.value=1*(this.dataZoom.volumeYAxisStartValue+n*this.volumeUnitToYAxisPx).toFixed(e.priceDigitNumber)):(r.value=1*(this.dataZoom.klineYAxisStartValue+n*this.candleUnitToYAxisPx).toFixed(e.priceDigitNumber),r.type="price"),r}},{key:"findTicker",value:function(t,i){var e=this.chart,a=this.view,r=this.mapCoordinateToData(t-a.padding.left,i-a.padding.top),n=r.time,o=r.value,s=r.type,h=this.dataZoom.data.filter((function(t){return t.time<=n&&t.time+e.tickerUnit>=n}));return{ticker:x(h,1)[0],value:o,type:s}}}]),t}(),A=function t(){h(this,t)};c(A,"up","#04BD75"),c(A,"upHighlight","#03A46B"),c(A,"upLowlight","rgba(4,189,117,0.6)"),c(A,"down","#CF304A"),c(A,"downHighlight","#C02944"),c(A,"downLowlight","rgba(207,48,74,0.6)");var b=function t(){h(this,t)};function E(t,i){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,i){if(!t)return;if("string"==typeof t)return M(t,i);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return M(t,i)}(t))||i&&t&&"number"==typeof t.length){e&&(t=e);var a=0,r=function(){};return{s:r,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return o=t.done,t},e:function(t){s=!0,n=t},f:function(){try{o||null==e.return||e.return()}finally{if(s)throw n}}}}function M(t,i){(null==i||i>t.length)&&(i=t.length);for(var e=0,a=new Array(i);e<i;e++)a[e]=t[e];return a}c(b,"CANVAS_ID","__bigo-chart__"),c(b,"CANDLE_INFO_CONTAINER_ID","__candle-info__"),c(b,"MA_INFO_CONTAINER_ID","__MA-info__"),c(b,"VOL_INFO_CONTAINER_ID","__vol-info__"),c(b,"VOL_SPAN_ID","__vol-span__"),c(b,"VOL_VALUE_ID","__vol-value__"),c(b,"TIME_SPAN_ID","__time-span__"),c(b,"OPEN_SPAN_ID","__open-span__"),c(b,"OPEN_VALUE_ID","__open-value__"),c(b,"HIGH_SPAN_ID","__high-span__"),c(b,"HIGH_VALUE_ID","__high-value__"),c(b,"LOW_SPAN_ID","__low-span__"),c(b,"LOW_VALUE_ID","__low-value__"),c(b,"CLOSE_SPAN_ID","__close-span__"),c(b,"CLOSE_VALUE_ID","__close-value__"),c(b,"CHANGE_SPAN_ID","__change-span__"),c(b,"CHANGE_VALUE_ID","__change-value__"),c(b,"AMPLITUDE_SPAN_ID","__amplitude-span__"),c(b,"AMPLITUDE_VALUE_ID","__amplitude-value__");var L=function(){function t(){h(this,t),c(this,"service",void 0),c(this,"controller",void 0),c(this,"chart",void 0),c(this,"canvas",void 0),c(this,"ctx",void 0),c(this,"dpr",void 0),c(this,"logo",void 0),c(this,"padding",{}),c(this,"canvasHeight",void 0),c(this,"canvasWidth",void 0),c(this,"chartWidth",void 0),c(this,"chartHeight",void 0),c(this,"klineChartHeight",void 0),c(this,"volumeChartHeight",0),c(this,"xAxisUnitsVisiable",72e5),c(this,"chartYAxisUnitsVisiable",8),c(this,"volumeYAxisUnitsVisiable",4),c(this,"axisLabelSize",10),c(this,"scaleHeight",void 0),c(this,"candleWidth",void 0),c(this,"candleMargin",void 0)}return l(t,[{key:"inject",value:function(t,i,e){this.service=t,this.controller=i,this.chart=e}},{key:"createElements",value:function(){var t=this.chart;t.domUtils.setStyle(t.container,{position:"relative"});var i=t.container.getBoundingClientRect(),e=i.height,a=i.width;this.canvas=t.domUtils.createElm("canvas",{id:b.CANVAS_ID,height:e,width:a}),this.ctx=this.canvas.getContext("2d"),t.domUtils.appendElms(this.canvas);var r=t.domUtils.createElm("div",{id:b.CANDLE_INFO_CONTAINER_ID});t.domUtils.appendElms(r,t.container);var n=t.domUtils.createElm("span",{id:b.TIME_SPAN_ID});n.innerHTML="N/A";var o=t.domUtils.createElm("span",{id:b.OPEN_SPAN_ID});o.innerHTML="O:";var s=t.domUtils.createElm("span",{id:b.OPEN_VALUE_ID});s.innerHTML="N/A";var h=t.domUtils.createElm("span",{id:b.HIGH_SPAN_ID});h.innerHTML="H:";var l=t.domUtils.createElm("span",{id:b.HIGH_VALUE_ID});l.innerHTML="N/A";var c=t.domUtils.createElm("span",{id:b.LOW_SPAN_ID});c.innerHTML="L:";var d=t.domUtils.createElm("span",{id:b.LOW_VALUE_ID});d.innerHTML="N/A";var u=t.domUtils.createElm("span",{id:b.CLOSE_SPAN_ID});u.innerHTML="C:";var v=t.domUtils.createElm("span",{id:b.CLOSE_VALUE_ID});v.innerHTML="N/A";var f=t.domUtils.createElm("span",{id:b.CHANGE_SPAN_ID});f.innerHTML="CHANGE:";var p=t.domUtils.createElm("span",{id:b.CHANGE_VALUE_ID});p.innerHTML="N/A";var m=t.domUtils.createElm("span",{id:b.AMPLITUDE_SPAN_ID});m.innerHTML="AMPLITUDE:";var g=t.domUtils.createElm("span",{id:b.AMPLITUDE_VALUE_ID});g.innerHTML="N/A",t.domUtils.appendElms([n,o,s,h,l,c,d,u,v,f,p,m,g],r);var x=t.domUtils.createElm("div",{id:b.MA_INFO_CONTAINER_ID});if(t.MAOptions.forEach((function(i){var e=t.domUtils.createElm("span");e.innerHTML="MA(".concat(i.interval,"):"),t.domUtils.appendElms(e,x);var a=t.domUtils.createElm("span",{id:"__ma-".concat(i.interval,"__"),style:"color:".concat(i.color)});a.innerHTML="N/A",t.domUtils.appendElms(a,x)})),t.domUtils.appendElms(x,t.container),t.options.hasVolume){var y=t.domUtils.createElm("div",{id:b.VOL_INFO_CONTAINER_ID});t.domUtils.appendElms(y,t.container);var w=t.domUtils.createElm("span",{id:b.VOL_SPAN_ID});w.innerHTML="Vol(".concat(t.options.volumeSymbol,"):");var _=t.domUtils.createElm("span",{id:b.VOL_VALUE_ID});t.domUtils.appendElms([w,_],y)}}},{key:"highDefinition",value:function(){this.dpr=window.devicePixelRatio||1;var t=this.canvas.getBoundingClientRect();this.canvas.width=t.width*this.dpr,this.canvas.height=t.height*this.dpr,this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.canvas.style.height=this.canvas.height/this.dpr+"px",this.canvas.style.width=this.canvas.width/this.dpr+"px"}},{key:"initChart",value:function(){var t=this.chart,i=this.controller,e=t.options.logo;e&&(this.logo=new Image,this.logo.src=e,this.highDefinition(),i.registerMouseEvents(),this.draw())}},{key:"resize",value:function(){var t=this.chart;this.service.calcPadding(t.bars),this.chartHeight=this.canvasHeight-this.padding.top-this.padding.bottom,this.chartWidth=this.canvasWidth-this.padding.left-this.padding.right,t.options.hasVolume&&(this.volumeChartHeight=this.chartHeight/3),this.klineChartHeight=this.chartHeight-this.volumeChartHeight,t.domUtils.getDOMElm("#"+b.VOL_INFO_CONTAINER_ID).style="top:".concat((this.canvasHeight-this.volumeChartHeight)/this.dpr,"px")}},{key:"clearCanvas",value:function(){this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight}},{key:"drawLogo",value:function(){var t=348*this.dpr,i=85.5*this.dpr;this.ctx.drawImage(this.logo,this.canvasWidth/2-t/2,this.canvasHeight/2-i/2,t,i)}},{key:"draw",value:function(){var t=this.service,i=this.controller;this.resize(),t.calcDataZoom(t.dataZoom.user?"update":"init"),this.clearCanvas(),this.drawBg(),this.drawAxis(),this.drawMAs(),this.drawTicker(),this.drawTickerInfo(),this.drawLastTickerPrice(),this.drawCursorCross(i.nowMousePosition.x,i.nowMousePosition.y)}},{key:"drawBg",value:function(){var t=this,i=this.chart;this.ctx.beginPath(),this.ctx.fillStyle=i.options.backgroundColor||"#191b20",this.ctx.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.logo&&(this.logo.complete?this.drawLogo():this.logo.onload=function(){t.drawLogo()})}},{key:"drawAxis",value:function(){var t=this.service;t.calcUnitToXAxisPx(),t.calcUnitToYAxisPx(),this.drawXAxis(),this.drawYAxis()}},{key:"drawXAxis",value:function(){var t=this.service,i=this.chart,e=t.calcXAxisCoordinate();this.scaleHeight=5*this.dpr,i.canvasUtils.drawLine({x:this.padding.left,y:this.chartHeight+this.padding.top},{x:this.chartWidth+this.padding.left,y:this.chartHeight+this.padding.top},"#34383F");var a,r=E(e);try{for(r.s();!(a=r.n()).done;){var n=a.value,o=n.x;o>=this.padding.left+this.chartWidth||o<=this.padding.left||(i.canvasUtils.drawLine({x:o,y:this.chartHeight+this.padding.top},{x:o,y:this.chartHeight+this.padding.top+this.scaleHeight},"rgb(132, 142, 156)"),i.canvasUtils.drawLine({x:o,y:this.padding.top},{x:o,y:this.chartHeight+this.padding.top},"#24272C"),this.drawLabels({x:o,y:void 0},n.time))}}catch(t){r.e(t)}finally{r.f()}}},{key:"drawYAxis",value:function(){var t=this,i=this.service,e=this.chart;(e.canvasUtils.drawLine({x:this.padding.left+this.chartWidth,y:this.padding.top},{x:this.padding.left+this.chartWidth,y:this.chartHeight+this.padding.top},"#34383F"),i.calcYAxisCoordinate("candle").forEach((function(i){e.canvasUtils.drawLine({x:t.padding.left+t.chartWidth,y:i.y},{x:t.chartWidth+t.padding.top+t.scaleHeight,y:i.y},"rgb(132, 142, 156)"),e.canvasUtils.drawLine({x:t.padding.left,y:i.y},{x:t.chartWidth+t.padding.left,y:i.y},"#24272C"),t.drawLabels({x:void 0,y:i.y},i.value)})),e.options.hasVolume)&&i.calcYAxisCoordinate("volume").forEach((function(i){e.canvasUtils.drawLine({x:t.padding.left+t.chartWidth,y:i.y},{x:t.chartWidth+t.padding.top+t.scaleHeight,y:i.y},"rgb(132, 142, 156)"),e.canvasUtils.drawLine({x:t.padding.left,y:i.y},{x:t.chartWidth+t.padding.left,y:i.y},"#24272C"),t.drawLabels({x:void 0,y:i.y},i.value)}))}},{key:"drawLabels",value:function(t,i){var e=this.chart,a=i,r={x:0,y:0};t.x?(a=u("HH:MM",new Date(i)),r.x=t.x,r.y=this.chartHeight+this.padding.top+this.scaleHeight):(a=d(a,e.priceDigitNumber),r.x=this.padding.left+this.chartWidth+this.scaleHeight+2*this.dpr,r.y=t.y),e.canvasUtils.drawText(r.x,r.y,a,this.axisLabelSize*this.dpr+"px sans-serif",t.x?"top":"middle","rgb(132, 142, 156)",t.x?"center":"left")}},{key:"drawTicker",value:function(){var t=this,i=this.service,e=this.chart;i.dataZoom.realData.forEach((function(i){t.drawCandle(i),e.options.hasVolume&&t.drawVolume(i)}))}},{key:"drawCandle",value:function(t){var i=this.service,e=this.chart;i.formatTickerData(t);var a=t.status,r=i.mapDataToCoordinate(t.time,t.open),n=i.mapDataToCoordinate(t.time,t.close),o=i.mapDataToCoordinate(t.time,t.high),s=i.mapDataToCoordinate(t.time,t.low);this.candleMargin=e.tickerUnit/20/i.unitToXAxisPx,this.candleWidth=e.tickerUnit/i.unitToXAxisPx-2*this.candleMargin;var h="up"===a?n.x-this.candleWidth/2:r.x-this.candleWidth/2,l="up"===a?n.y:r.y,c=Math.abs(n.y-r.y),d=this.candleWidth;if(h+d>=this.padding.left+this.chartWidth)(d=d-(h+d-this.padding.left-this.chartWidth)-2*this.dpr)<0&&(d=0);else if(h<this.padding.left){if(h+d<this.padding.left)return;d-=this.padding.left-h,h=this.padding.left}else e.canvasUtils.drawLine({x:r.x,y:o.y},{x:r.x,y:s.y},A[a]);e.canvasUtils.drawRect(h,l,d,c,A[a])}},{key:"drawVolumes",value:function(){var t=this;this.service.dataZoom.realData.forEach((function(i){return t.drawVolume(i)}))}},{key:"drawVolume",value:function(t){var i=this.service,e=this.chart,a=i.mapDataToCoordinate(t.time,t.volume,"volume"),r=a.x,n=a.y,o=this.candleWidth,s=this.canvasHeight-this.padding.bottom-n,h=r-o/2;if(h+o>=this.padding.left+this.chartWidth)(o=o-(h+o-this.padding.left-this.chartWidth)-2*this.dpr)<0&&(o=0);else if(h<this.padding.left){if(h+o<this.padding.left)return;o-=this.padding.left-h,h=this.padding.left}e.canvasUtils.drawRect(h,n,o,s,A[t.status+"Lowlight"])}},{key:"drawMAs",value:function(){var t=this,i=this.service,e=this.chart;i.calcMAPoints(),e.MAOptions.forEach((function(a){var r=a.points.map((function(t){return i.mapDataToCoordinate(t.time,t.value)}));t.ctx.beginPath();for(var n=0;n<r.length;n++){var o=r[n],s=r[n+1];if(!s)break;o.x<=t.padding.left||s.x>=t.chartWidth+t.padding.left||(o.y>t.padding.top+t.klineChartHeight||s.y>t.padding.top+t.klineChartHeight||e.canvasUtils.drawLine({x:o.x,y:o.y},{x:s.x,y:s.y},a.color,!1))}t.ctx.stroke()}))}},{key:"drawTickerInfo",value:function(){var t=this.chart,i=t.cursorTicker||t.bars[t.bars.length-1];this.drawCandleInfo(i);var e,a={},r=E(t.MAOptions);try{for(r.s();!(e=r.n()).done;){var n=e.value;if(a[n.interval]=n.points.find((function(t){return t.time===i.time})),!a[n.interval])return;a[n.interval].color=n.color}}catch(t){r.e(t)}finally{r.f()}this.drawMAInfo(a),t.options.hasVolume&&this.drawVolumeInfo(i)}},{key:"drawCandleInfo",value:function(t){var i=this.chart,e=i.domUtils;i.domUtils.getDOMElm("#"+b.TIME_SPAN_ID).innerHTML=u("YYYY/mm/dd HH:MM",new Date(t.time));var a=i.domUtils.getDOMElm("#"+b.OPEN_VALUE_ID);a.innerHTML=d(t.open,i.priceDigitNumber),e.setStyle(a,{color:A[t.status]});var r=i.domUtils.getDOMElm("#"+b.LOW_VALUE_ID);r.innerHTML=d(t.low,i.priceDigitNumber),e.setStyle(r,{color:A[t.status]});var n=i.domUtils.getDOMElm("#"+b.CLOSE_VALUE_ID);n.innerHTML=d(t.close,i.priceDigitNumber),e.setStyle(n,{color:A[t.status]});var o=i.domUtils.getDOMElm("#"+b.CHANGE_VALUE_ID);o.innerHTML=d(t.change,2),e.setStyle(o,{color:A[t.status]});var s=i.domUtils.getDOMElm("#"+b.AMPLITUDE_VALUE_ID);s.innerHTML=d(t.amplitude,2),e.setStyle(s,{color:A[t.status]})}},{key:"drawMAInfo",value:function(t){var i=this.chart,e=i.domUtils;for(var a in t){var r=t[a],n=i.domUtils.getDOMElm("#__ma-".concat(a,"__"));n.innerHTML=d(r.value,i.priceDigitNumber),e.setStyle(n,{color:r.color})}}},{key:"drawVolumeInfo",value:function(t){var i=this.chart,e=i.domUtils,a=i.domUtils.getDOMElm("#".concat(b.VOL_VALUE_ID));a.innerHTML=d(t.volume,i.volumeDigitNumer),e.setStyle(a,{color:A[t.status]})}},{key:"drawCursorCross",value:function(t,i){if(t&&i){var e=this.chart,a=this.dpr*t,r=this.dpr*i;a>=this.padding.left+this.chartWidth||r>this.padding.top+this.chartHeight?this.canvas.style.cursor="default":(this.canvas.style.cursor="crosshair",a=this.drawCursorLabel(a,r),e.canvasUtils.drawLine({x:this.padding.left,y:r},{x:this.padding.left+this.chartWidth,y:r},"#AEB4BC",!0,[5*this.dpr,5*this.dpr]),e.canvasUtils.drawLine({x:a,y:this.padding.top},{x:a,y:this.padding.top+this.chartHeight},"#AEB4BC",!0,[5*this.dpr,5*this.dpr]))}}},{key:"drawCursorLabel",value:function(t,i){var e=this.chart,a=this.service,r=a.findTicker(t,i),n=r.ticker,o=r.type,s=r.value;if(e.cursorTicker=n,!n)return t;var h=a.mapDataToCoordinate(n.time,0),l=u("YYYY/mm/dd HH:MM",new Date(n.time)),c=e.canvasUtils.getTextWidthAndHeight(this.axisLabelSize*this.dpr,"sans-serif",l),d=c.width,v=c.height,f=d+15*this.dpr,p=this.padding.bottom;return e.canvasUtils.drawRect(h.x-f/2,this.chartHeight+this.padding.top,f,p,"#2B2F36"),e.canvasUtils.drawText(h.x,this.chartHeight+this.padding.top+p/2-v/2,l,this.axisLabelSize*this.dpr+"px sans-serif","top","#fff","center"),this.drawYAxisLabelPolygon(i,"#2B2F36","#3D434C",s,o),h.x}},{key:"drawYAxisLabelPolygon",value:function(t,i,e,a,r){var n=this.chart,o=20*this.dpr,s=this.padding.right,h=[{x:this.padding.left+this.chartWidth,y:t},{x:this.padding.left+this.chartWidth+s/6,y:t-o/2},{x:this.padding.left+this.chartWidth+s,y:t-o/2},{x:this.padding.left+this.chartWidth+s,y:t+o/2},{x:this.padding.left+this.chartWidth+s/6,y:t+o/2}],l="price"===r?d(a,n.priceDigitNumber):a,c=n.canvasUtils.getTextWidthAndHeight(this.axisLabelSize*this.dpr,"sans-serif",l).width;n.canvasUtils.drawPolygon(h,"fill",i,1*this.dpr),n.canvasUtils.drawPolygon(h,"stroke",e,1*this.dpr),n.canvasUtils.drawText(this.padding.left+this.chartWidth+this.scaleHeight+this.padding.right/2-c/2,t,l,12*this.dpr+"px ","middle","#fff","left")}},{key:"drawLastTickerPrice",value:function(){var t=this.service,i=t.dataZoom.data[t.dataZoom.data.length-1],e=t.mapDataToCoordinate(i.time,i.close).y;this.drawYAxisLabelPolygon(e,A[i.status],"up"===i.status?A.upHighlight:A.downHighlight,i.close,"price")}}]),t}();return function(){function t(i){var e;h(this,t),c(this,"view",void 0),c(this,"service",void 0),c(this,"controller",void 0),c(this,"options",void 0),c(this,"bars",void 0),c(this,"container",void 0),c(this,"canvasUtils",void 0),c(this,"domUtils",void 0),c(this,"tickerUnit",void 0),c(this,"cursorTicker",void 0),c(this,"priceDigitNumber",2),c(this,"volumeDigitNumer",3),c(this,"MAOptions",[{color:"#FF00FF",interval:7},{color:"#CF3049",interval:25},{color:"#00CCCC",interval:99}]),c(this,"MAData",void 0),c(this,"maxMAInterval",void 0),this.view=new L,this.service=new _,this.controller=new f,this.inject(),this.checkOptions(i),this.container=document.querySelector(this.options.el),this.container||v("invalid dom"),this.domUtils=function(t){function i(t,i){var e=document.createElement(t);for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a]);return e}function e(i,e){var a=e||t;Array.isArray(i)?i.forEach((function(t){return a.appendChild(t)})):a.appendChild(i)}return{createElm:i,appendElms:e,setStyle:function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t.style[e]=i[e])},getDOMElm:function(t,a){var r=document.querySelector(t);if(!r){for(var n=arguments.length,o=new Array(n>2?n-2:0),s=2;s<n;s++)o[s-2]=arguments[s];e(r=i.apply(void 0,o),a)}return r}}}(this.container),this.view.createElements(),this.canvasUtils=(e=this.view.ctx,{drawLine:function(t,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#fff",r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0,0];r&&e.beginPath(),e.setLineDash(n),e.moveTo(t.x,t.y),e.lineTo(i.x,i.y),e.strokeStyle=a,r&&e.stroke()},drawRect:function(t,i,a,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"#fff";e.fillStyle=n,e.lineWidth=1,e.beginPath(),e.rect(t,i,a,r),e.fill()},drawPolygon:function(t,i,a,r){e.beginPath(),e.lineWidth=r,e.moveTo(t[0].x,t[0].y),t.forEach((function(t,i){i>=1&&e.lineTo(t.x,t.y)})),e.lineTo(t[0].x,t[0].y),e[i+"Style"]=a,e.closePath(),e[i]()},drawText:function(t,i,a,r,n,o,s){e.font=r,e.textBaseline=n,e.textAlign=s,e.fillStyle=o,e.fillText(a,t,i)},getTextWidthAndHeight:function(t,i,a){return e.font=t+"px "+i,{width:e.measureText(a).width,height:t}}}),i.MA&&(this.MAOptions=i.MA),this.maxMAInterval=Math.max.apply(Math,s(this.MAOptions.map((function(t){return t.interval})))),this.bars=i.bars.sort((function(t,i){return t.time-i.time})),this.options.hasVolume&&(this.options.hasVolume=this.bars.every((function(t){return!!t.volume}))),this.tickerUnit=this.bars[1].time-this.bars[0].time,this.view.initChart()}return l(t,[{key:"inject",value:function(){this.service.inject(this.view,this.controller,this),this.controller.inject(this.view,this.service,this),this.view.inject(this.service,this.controller,this)}},{key:"checkOptions",value:function(t){t&&Object.keys(t).length||v("invalid options"),this.options=t}},{key:"subscribeBars",value:function(t,i,e){var a=this.bars[this.bars.length-1],r={open:a.open,high:a.high,low:a.low,close:t,volume:a.volume,time:a.time};e-a.time>=this.tickerUnit?(r.open=a.close,r.high=t,r.low=t,r.time=e,r.volume=i,this.bars.push(r)):(t>a.high&&(r.high=t),t<a.low&&(r.low=t),r.volume+=i,this.bars[this.bars.length-1]=r),this.view.draw()}}]),t}()}();
