var BigoChart=function(){"use strict";function t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function i(t,i){return t(i={exports:{}},i.exports),i.exports}var e=i((function(t){t.exports=function(t,i){(null==i||i>t.length)&&(i=t.length);for(var e=0,r=new Array(i);e<i;e++)r[e]=t[e];return r},t.exports.default=t.exports,t.exports.__esModule=!0}));t(e);var r=i((function(t){t.exports=function(t){if(Array.isArray(t))return e(t)},t.exports.default=t.exports,t.exports.__esModule=!0}));t(r);var a=i((function(t){t.exports=function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)},t.exports.default=t.exports,t.exports.__esModule=!0}));t(a);var n=i((function(t){t.exports=function(t,i){if(t){if("string"==typeof t)return e(t,i);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,i):void 0}},t.exports.default=t.exports,t.exports.__esModule=!0}));t(n);var o=i((function(t){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.default=t.exports,t.exports.__esModule=!0}));t(o);var s=t(i((function(t){t.exports=function(t){return r(t)||a(t)||n(t)||o()},t.exports.default=t.exports,t.exports.__esModule=!0}))),h=t(i((function(t){t.exports=function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")},t.exports.default=t.exports,t.exports.__esModule=!0}))),l=t(i((function(t){function i(t,i){for(var e=0;e<i.length;e++){var r=i[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}t.exports=function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t},t.exports.default=t.exports,t.exports.__esModule=!0}))),c=t(i((function(t){t.exports=function(t,i,e){return i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t},t.exports.default=t.exports,t.exports.__esModule=!0})));function d(t,i){var e,r={"Y+":i.getFullYear().toString(),"m+":(i.getMonth()+1).toString(),"d+":i.getDate().toString(),"H+":i.getHours().toString(),"M+":i.getMinutes().toString(),"S+":i.getSeconds().toString()};for(var a in r)(e=new RegExp("("+a+")").exec(t))&&(t=t.replace(e[1],1===e[1].length?r[a]:r[a].padStart(e[1].length,"0")));return t}function u(t,i){if(0===t)return"0.00";if(!t)return"--";var e=t.toString().split(".")[1],r=Number(t.toString().split(".")[0]);return e=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1?arguments[1]:void 0;if(void 0!==i)if(0!==i)if(t)if(t.length>i)t=t.slice(0,i);else for(var e=0,r=i-t.length;e<r;e++)t+="0";else for(var a=0;a<i;a++)t+="0";else 0===i&&(t="");return t&&(t="."+t),t}(e,i),-1!==t.toString().indexOf("-")&&Math.abs(parseFloat(r))<=0?"-"+"".concat(r).concat(e):"".concat(r).concat(e)}var v=function(){function t(){h(this,t),c(this,"view",void 0),c(this,"service",void 0),c(this,"chart",void 0),c(this,"isMouseDown",!1),c(this,"prevMousePosition",{}),c(this,"nowMousePosition",{}),c(this,"dragCoefficient",1e3)}return l(t,[{key:"inject",value:function(t,i,e){this.view=t,this.service=i,this.chart=e}},{key:"registerMouseEvents",value:function(){var t=this.view;t.canvas.addEventListener("mousedown",this.onMouseDown.bind(this)),t.canvas.addEventListener("mousemove",this.onMouseMove.bind(this)),t.canvas.addEventListener("mouseup",this.onMouseUp.bind(this)),t.canvas.addEventListener("mousewheel",this.onMouseWeel.bind(this))}},{key:"onMouseDown",value:function(t){this.isMouseDown=!0,this.prevMousePosition={x:t.offsetX,y:t.offsetY}}},{key:"onMouseMove",value:function(t){var i=this.chart,e=this.view,r=this.service,a=t.offsetX,n=t.offsetY;if(this.nowMousePosition={x:a,y:n},!this.isMouseDown)return e.draw();r.dataZoom.user=!0;var o=this.prevMousePosition.x-this.nowMousePosition.x,s=i.bars[0].time,h=r.dataZoom.xAxisStartValue+this.dragCoefficient*o,l=r.dataZoom.xAxisEndValue+this.dragCoefficient*o;h-100*i.tickerUnit<=s?r.loadMoreData():(this.dragCoefficient=e.xAxisUnitsVisiable/i.tickerUnit*40,r.updateDataZoom(h,l),e.draw(),this.prevMousePosition={x:a,y:n})}},{key:"onMouseUp",value:function(){this.isMouseDown=!1}},{key:"onMouseWeel",value:function(t){var i,e,r,a=this.view,n=this.service;if(n.dataZoom.user=!0,t.wheelDelta?(i=t.wheelDelta/120,window.opera&&(i=-i)):t.detail&&(i=-t.detail/3),i>=0){if(n.dataZoom.data.length<=20)return;e=n.dataZoom.xAxisStartValue+12e4,r=n.dataZoom.xAxisEndValue-12e4}else{if(n.dataZoom.data.length>=200)return;e=n.dataZoom.xAxisStartValue-12e4,r=n.dataZoom.xAxisEndValue+12e4}n.updateDataZoom(e,r),a.draw()}}]),t}(),f=i((function(t){t.exports=function(t){if(Array.isArray(t))return t},t.exports.default=t.exports,t.exports.__esModule=!0}));t(f);var p=i((function(t){t.exports=function(t,i){var e=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null!=e){var r,a,n=[],o=!0,s=!1;try{for(e=e.call(t);!(o=(r=e.next()).done)&&(n.push(r.value),!i||n.length!==i);o=!0);}catch(t){s=!0,a=t}finally{try{o||null==e.return||e.return()}finally{if(s)throw a}}return n}},t.exports.default=t.exports,t.exports.__esModule=!0}));t(p);var m=i((function(t){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.default=t.exports,t.exports.__esModule=!0}));t(m);var g=t(i((function(t){t.exports=function(t,i){return f(t)||p(t,i)||n(t,i)||m()},t.exports.default=t.exports,t.exports.__esModule=!0}))),x=t(i((function(t){function i(t,i,e,r,a,n,o){try{var s=t[n](o),h=s.value}catch(t){return void e(t)}s.done?i(h):Promise.resolve(h).then(r,a)}t.exports=function(t){return function(){var e=this,r=arguments;return new Promise((function(a,n){var o=t.apply(e,r);function s(t){i(o,a,n,s,h,"next",t)}function h(t){i(o,a,n,s,h,"throw",t)}s(void 0)}))}},t.exports.default=t.exports,t.exports.__esModule=!0}))),y=i((function(t){var i=function(t){var i,e=Object.prototype,r=e.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},n=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function h(t,i,e){return Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[i]}try{h({},"")}catch(t){h=function(t,i,e){return t[i]=e}}function l(t,i,e,r){var a=i&&i.prototype instanceof m?i:m,n=Object.create(a.prototype),o=new D(r||[]);return n._invoke=function(t,i,e){var r=d;return function(a,n){if(r===v)throw new Error("Generator is already running");if(r===f){if("throw"===a)throw n;return T()}for(e.method=a,e.arg=n;;){var o=e.delegate;if(o){var s=M(o,e);if(s){if(s===p)continue;return s}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if(r===d)throw r=f,e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);r=v;var h=c(t,i,e);if("normal"===h.type){if(r=e.done?f:u,h.arg===p)continue;return{value:h.arg,done:e.done}}"throw"===h.type&&(r=f,e.method="throw",e.arg=h.arg)}}}(t,e,o),n}function c(t,i,e){try{return{type:"normal",arg:t.call(i,e)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var d="suspendedStart",u="suspendedYield",v="executing",f="completed",p={};function m(){}function g(){}function x(){}var y={};y[n]=function(){return this};var w=Object.getPrototypeOf,_=w&&w(w(k([])));_&&_!==e&&r.call(_,n)&&(y=_);var A=x.prototype=m.prototype=Object.create(y);function b(t){["next","throw","return"].forEach((function(i){h(t,i,(function(t){return this._invoke(i,t)}))}))}function E(t,i){function e(a,n,o,s){var h=c(t[a],t,n);if("throw"!==h.type){var l=h.arg,d=l.value;return d&&"object"==typeof d&&r.call(d,"__await")?i.resolve(d.__await).then((function(t){e("next",t,o,s)}),(function(t){e("throw",t,o,s)})):i.resolve(d).then((function(t){l.value=t,o(l)}),(function(t){return e("throw",t,o,s)}))}s(h.arg)}var a;this._invoke=function(t,r){function n(){return new i((function(i,a){e(t,r,i,a)}))}return a=a?a.then(n,n):n()}}function M(t,e){var r=t.iterator[e.method];if(r===i){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=i,M(t,e),"throw"===e.method))return p;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=c(r,t.iterator,e.arg);if("throw"===a.type)return e.method="throw",e.arg=a.arg,e.delegate=null,p;var n=a.arg;return n?n.done?(e[t.resultName]=n.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=i),e.delegate=null,p):n:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function L(t){var i={tryLoc:t[0]};1 in t&&(i.catchLoc=t[1]),2 in t&&(i.finallyLoc=t[2],i.afterLoc=t[3]),this.tryEntries.push(i)}function U(t){var i=t.completion||{};i.type="normal",delete i.arg,t.completion=i}function D(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function k(t){if(t){var e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function e(){for(;++a<t.length;)if(r.call(t,a))return e.value=t[a],e.done=!1,e;return e.value=i,e.done=!0,e};return o.next=o}}return{next:T}}function T(){return{value:i,done:!0}}return g.prototype=A.constructor=x,x.constructor=g,g.displayName=h(x,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var i="function"==typeof t&&t.constructor;return!!i&&(i===g||"GeneratorFunction"===(i.displayName||i.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,h(t,s,"GeneratorFunction")),t.prototype=Object.create(A),t},t.awrap=function(t){return{__await:t}},b(E.prototype),E.prototype[o]=function(){return this},t.AsyncIterator=E,t.async=function(i,e,r,a,n){void 0===n&&(n=Promise);var o=new E(l(i,e,r,a),n);return t.isGeneratorFunction(e)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},b(A),h(A,s,"Generator"),A[n]=function(){return this},A.toString=function(){return"[object Generator]"},t.keys=function(t){var i=[];for(var e in t)i.push(e);return i.reverse(),function e(){for(;i.length;){var r=i.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=k,D.prototype={constructor:D,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=i,this.done=!1,this.delegate=null,this.method="next",this.arg=i,this.tryEntries.forEach(U),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=i)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function a(r,a){return s.type="throw",s.arg=t,e.next=r,a&&(e.method="next",e.arg=i),!!a}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],s=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var h=r.call(o,"catchLoc"),l=r.call(o,"finallyLoc");if(h&&l){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(h){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(t,i){for(var e=this.tryEntries.length-1;e>=0;--e){var a=this.tryEntries[e];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var n=a;break}}n&&("break"===t||"continue"===t)&&n.tryLoc<=i&&i<=n.finallyLoc&&(n=null);var o=n?n.completion:{};return o.type=t,o.arg=i,n?(this.method="next",this.next=n.finallyLoc,p):this.complete(o)},complete:function(t,i){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&i&&(this.next=i),p},finish:function(t){for(var i=this.tryEntries.length-1;i>=0;--i){var e=this.tryEntries[i];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),U(e),p}},catch:function(t){for(var i=this.tryEntries.length-1;i>=0;--i){var e=this.tryEntries[i];if(e.tryLoc===t){var r=e.completion;if("throw"===r.type){var a=r.arg;U(e)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=i),p}},t}(t.exports);try{regeneratorRuntime=i}catch(t){Function("r","regeneratorRuntime = r")(i)}})),w=function(){function t(){h(this,t),c(this,"view",void 0),c(this,"controller",void 0),c(this,"chart",void 0),c(this,"unitToXAxisPx",0),c(this,"candleUnitToYAxisPx",0),c(this,"volumeUnitToYAxisPx",0),c(this,"highestVolume",void 0),c(this,"dataZoom",{}),c(this,"loadMorePending",void 0),c(this,"hasMoreData",!0),c(this,"yAxisBuffer",.1)}var i;return l(t,[{key:"inject",value:function(t,i,e){this.view=t,this.controller=i,this.chart=e}},{key:"calcUnitToXAxisPx",value:function(){var t=this.view;this.unitToXAxisPx=t.xAxisUnitsVisiable/t.chartWidth}},{key:"calcUnitToYAxisPx",value:function(){var t=this.view;this.candleUnitToYAxisPx=(this.dataZoom.klineYAxisEndValue-this.dataZoom.klineYAxisStartValue)/t.klineChartHeight,this.volumeUnitToYAxisPx=(this.dataZoom.volumeYAxisEndValue-this.dataZoom.volumeYAxisStartValue)/t.volumeChartHeight}},{key:"calcXAxisCoordinate",value:function(){for(var t=this,i=this.chart,e=Math.floor(this.dataZoom.data.length/8),r=[],a=0;a<i.bars.length;a+=e)r.push({time:i.bars[a].time,value:0});return r.map((function(i){return{x:t.mapDataToCoordinate(i.time,i.value).x,y:0,time:i.time}}))}},{key:"calcYAxisCoordinate",value:function(){var t,i,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"kline",r=this.view,a=this.highestVolume;"kline"===e?(i=r.chartYAxisUnitsVisiable,t=(this.dataZoom.klineYAxisEndValue-this.dataZoom.klineYAxisStartValue)/(r.chartYAxisUnitsVisiable-1)):(i=r.volumeYAxisUnitsVisiable,t=(a-this.dataZoom.volumeYAxisStartValue)/(r.volumeYAxisUnitsVisiable-1));for(var n=[],o=0;o<i;o++){var s=void 0;s="kline"===e?this.dataZoom.klineYAxisStartValue+o*t:this.dataZoom.volumeYAxisStartValue+o*t;var h=this.mapDataToCoordinate(0,s,e);n.push({x:r.padding.left+r.chartWidth,y:h.y,value:s})}return n}},{key:"calcPadding",value:function(t){var i=this.chart,e=this.view,r=i.canvasUtils.getTextWidthAndHeight(e.axisLabelSize*e.dpr,"sans-serif",u(Math.max.apply(Math,s(t.map((function(t){return t.high})))),i.priceDigitNumber)).width;e.padding.top=15*e.dpr,e.padding.bottom=20*e.dpr,e.padding.left=15*e.dpr,e.padding.right=r+10*e.dpr}},{key:"updateDataZoom",value:function(t,i){var e=this.chart,r=e.bars[e.bars.length-1].time,a=e.bars[0].time;r<t||a>i||(this.dataZoom.xAxisStartValue=t,this.dataZoom.xAxisEndValue=i)}},{key:"calcDataZoom",value:function(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"update",e=this.chart,r=this.view;if("init"===i){var a=e.bars[e.bars.length-1].time+3*e.tickerUnit,n=a-r.xAxisUnitsVisiable;this.updateDataZoom(n,a)}else"update"===i&&(r.xAxisUnitsVisiable=this.dataZoom.xAxisEndValue-this.dataZoom.xAxisStartValue);this.dataZoom.data=e.bars.filter((function(i){return i.time<=t.dataZoom.xAxisEndValue&&i.time>=t.dataZoom.xAxisStartValue})),this.dataZoom.realData=e.bars.filter((function(i){return i.time<=t.dataZoom.xAxisEndValue+e.tickerUnit&&i.time>=t.dataZoom.xAxisStartValue-e.tickerUnit}));var o=Array.prototype.concat([],this.dataZoom.realData).sort((function(t,i){return i.high-t.high})),h=o[0].high;o.sort((function(t,i){return t.low-i.low}));var l=o[0].low;this.dataZoom.klineYAxisEndValue=h+(h-l)*this.yAxisBuffer,this.dataZoom.klineYAxisStartValue=l-(h-l)*this.yAxisBuffer,this.highestVolume=Math.max.apply(Math,s(o.map((function(t){return t.volume})))),this.dataZoom.volumeYAxisEndValue=this.highestVolume+this.highestVolume*this.yAxisBuffer,this.dataZoom.volumeYAxisStartValue=0}},{key:"calcMAPoints",value:function(){var t=this.chart;this.calcMAList(),t.MAOptions.forEach((function(i,e,r){for(var a,n=i.interval,o=[],s=[],h=0;h<t.MAData.length;h++){var l={value:t.MAData[h].close,time:t.MAData[h].time};s.push(l),h>=n-1&&(o.push({value:1*(a=s.map((function(t){return t.value})),a.reduce((function(t,i){return t+i}),0)/a.length).toFixed(t.priceDigitNumber),time:l.time}),s.shift())}r[e].points=o}))}},{key:"calcMAList",value:function(){var t=this,i=this.chart;i.MAData=i.bars.filter((function(e){return e.time<=t.dataZoom.xAxisEndValue+i.maxMAInterval*i.tickerUnit&&e.time>=t.dataZoom.xAxisStartValue-i.maxMAInterval*i.tickerUnit}))}},{key:"formatTickerData",value:function(t){t.status=t.close>=t.open?"up":"down",t.amplitude=(100*(t.high-t.low)/t.low).toFixed(2)+"%",t.change=(100*(t.close-t.high)/t.low).toFixed(2)+"%"}},{key:"loadMoreData",value:(i=x(y.mark((function t(){var i,e,r,a;return y.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=this.chart,e=this.view,!this.loadMorePending&&this.hasMoreData){t.next=3;break}return t.abrupt("return");case 3:if(r=i.bars[0].time,!i.options.loadMore){t.next=18;break}return this.loadMorePending=!0,t.next=8,i.options.loadMore(r);case 8:if(a=t.sent,this.loadMorePending=!1,a){t.next=13;break}return this.hasMoreData=!1,t.abrupt("return");case 13:a.sort((function(t,i){return t.time-i.time})),a[a.length-1].time.time===r.time&&a.splice(a.length-1,1),i.bars=a.concat(i.bars),e.draw();case 18:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"mapDataToCoordinate",value:function(t,i){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"kline",r=this.view,a={x:0,y:0};if(a.x=r.padding.left+1*((t-this.dataZoom.xAxisStartValue)/this.unitToXAxisPx).toFixed(1),"kline"===e){var n=1*((i-this.dataZoom.klineYAxisStartValue)/this.candleUnitToYAxisPx).toFixed(1);a.y=r.padding.top+r.klineChartHeight-n}else{var o=1*((i-this.dataZoom.volumeYAxisStartValue)/this.volumeUnitToYAxisPx).toFixed(1);a.y=r.padding.top+r.chartHeight-o}return a}},{key:"mapCoordinateToData",value:function(t,i){var e=this.chart,r=this.view,a={time:0,value:0,type:""};a.time=Math.floor(this.dataZoom.xAxisStartValue+t*this.unitToXAxisPx);var n=r.klineChartHeight-i;return n<0?(a.type="volume",n=r.chartHeight-i,a.value=1*(this.dataZoom.volumeYAxisStartValue+n*this.volumeUnitToYAxisPx).toFixed(e.priceDigitNumber)):(a.value=1*(this.dataZoom.klineYAxisStartValue+n*this.candleUnitToYAxisPx).toFixed(e.priceDigitNumber),a.type="price"),a}},{key:"findTicker",value:function(t,i){var e=this.chart,r=this.view,a=this.mapCoordinateToData(t-r.padding.left,i-r.padding.top),n=a.time,o=a.type,s=this.dataZoom.data.filter((function(t){return t.time<=n&&t.time+e.tickerUnit>=n}));return{ticker:g(s,1)[0],type:o}}}]),t}(),_=function t(){h(this,t)};c(_,"up","#04BD75"),c(_,"upHighlight","#03A46B"),c(_,"upLowlight","rgba(4,189,117,0.6)"),c(_,"down","#CF304A"),c(_,"downHighlight","#C02944"),c(_,"downLowlight","rgba(207,48,74,0.6)");var A=function t(){h(this,t)};function b(t,i){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,i){if(!t)return;if("string"==typeof t)return E(t,i);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return E(t,i)}(t))||i&&t&&"number"==typeof t.length){e&&(t=e);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return o=t.done,t},e:function(t){s=!0,n=t},f:function(){try{o||null==e.return||e.return()}finally{if(s)throw n}}}}function E(t,i){(null==i||i>t.length)&&(i=t.length);for(var e=0,r=new Array(i);e<i;e++)r[e]=t[e];return r}c(A,"CANVAS_ID","__bigo-chart__"),c(A,"CANDLE_INFO_CONTAINER_ID","__candle-info__"),c(A,"MA_INFO_CONTAINER_ID","__MA-info__"),c(A,"VOL_INFO_CONTAINER_ID","__vol-info__"),c(A,"VOL_SPAN_ID","__vol-span__"),c(A,"VOL_VALUE_ID","__vol-value__"),c(A,"TIME_SPAN_ID","__time-span__"),c(A,"OPEN_SPAN_ID","__open-span__"),c(A,"OPEN_VALUE_ID","__open-value__"),c(A,"HIGH_SPAN_ID","__high-span__"),c(A,"HIGH_VALUE_ID","__high-value__"),c(A,"LOW_SPAN_ID","__low-span__"),c(A,"LOW_VALUE_ID","__low-value__"),c(A,"CLOSE_SPAN_ID","__close-span__"),c(A,"CLOSE_VALUE_ID","__close-value__"),c(A,"CHANGE_SPAN_ID","__change-span__"),c(A,"CHANGE_VALUE_ID","__change-value__"),c(A,"AMPLITUDE_SPAN_ID","__amplitude-span__"),c(A,"AMPLITUDE_VALUE_ID","__amplitude-value__");var M=function(){function t(){h(this,t),c(this,"service",void 0),c(this,"controller",void 0),c(this,"chart",void 0),c(this,"canvas",void 0),c(this,"ctx",void 0),c(this,"dpr",void 0),c(this,"logo",void 0),c(this,"padding",{}),c(this,"canvasHeight",void 0),c(this,"canvasWidth",void 0),c(this,"chartWidth",void 0),c(this,"chartHeight",void 0),c(this,"klineChartHeight",void 0),c(this,"volumeChartHeight",0),c(this,"xAxisUnitsVisiable",72e5),c(this,"chartYAxisUnitsVisiable",8),c(this,"volumeYAxisUnitsVisiable",4),c(this,"axisLabelSize",10),c(this,"scaleHeight",void 0),c(this,"candleWidth",void 0),c(this,"candleMargin",void 0)}return l(t,[{key:"inject",value:function(t,i,e){this.service=t,this.controller=i,this.chart=e}},{key:"createElements",value:function(){var t=this.chart;t.domUtils.setStyle(t.container,{position:"relative"});var i=t.container.getBoundingClientRect(),e=i.height,r=i.width;this.canvas=t.domUtils.createElm("canvas",{id:A.CANVAS_ID,height:e,width:r}),this.ctx=this.canvas.getContext("2d"),t.domUtils.appendElms(this.canvas);var a=t.domUtils.createElm("div",{id:A.CANDLE_INFO_CONTAINER_ID});t.domUtils.appendElms(a,t.container);var n=t.domUtils.createElm("span",{id:A.TIME_SPAN_ID});n.innerHTML="N/A";var o=t.domUtils.createElm("span",{id:A.OPEN_SPAN_ID});o.innerHTML="O:";var s=t.domUtils.createElm("span",{id:A.OPEN_VALUE_ID});s.innerHTML="N/A";var h=t.domUtils.createElm("span",{id:A.HIGH_SPAN_ID});h.innerHTML="H:";var l=t.domUtils.createElm("span",{id:A.HIGH_VALUE_ID});l.innerHTML="N/A";var c=t.domUtils.createElm("span",{id:A.LOW_SPAN_ID});c.innerHTML="L:";var d=t.domUtils.createElm("span",{id:A.LOW_VALUE_ID});d.innerHTML="N/A";var u=t.domUtils.createElm("span",{id:A.CLOSE_SPAN_ID});u.innerHTML="C:";var v=t.domUtils.createElm("span",{id:A.CLOSE_VALUE_ID});v.innerHTML="N/A";var f=t.domUtils.createElm("span",{id:A.CHANGE_SPAN_ID});f.innerHTML="CHANGE:";var p=t.domUtils.createElm("span",{id:A.CHANGE_VALUE_ID});p.innerHTML="N/A";var m=t.domUtils.createElm("span",{id:A.AMPLITUDE_SPAN_ID});m.innerHTML="AMPLITUDE:";var g=t.domUtils.createElm("span",{id:A.AMPLITUDE_VALUE_ID});g.innerHTML="N/A",t.domUtils.appendElms([n,o,s,h,l,c,d,u,v,f,p,m,g],a);var x=t.domUtils.createElm("div",{id:A.MA_INFO_CONTAINER_ID});if(t.MAOptions.forEach((function(i){var e=t.domUtils.createElm("span");e.innerHTML="MA(".concat(i.interval,"):"),t.domUtils.appendElms(e,x);var r=t.domUtils.createElm("span",{id:"__ma-".concat(i.interval,"__"),style:"color:".concat(i.color)});r.innerHTML="N/A",t.domUtils.appendElms(r,x)})),t.domUtils.appendElms(x,t.container),t.options.hasVolume){var y=t.domUtils.createElm("div",{id:A.VOL_INFO_CONTAINER_ID});t.domUtils.appendElms(y,t.container);var w=t.domUtils.createElm("span",{id:A.VOL_SPAN_ID});w.innerHTML="Vol(".concat(t.options.volumeSymbol,"):");var _=t.domUtils.createElm("span",{id:A.VOL_VALUE_ID});t.domUtils.appendElms([w,_],y)}}},{key:"highDefinition",value:function(){this.dpr=window.devicePixelRatio||1;var t=this.canvas.getBoundingClientRect();this.canvas.width=t.width*this.dpr,this.canvas.height=t.height*this.dpr,this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.canvas.style.height=this.canvas.height/this.dpr+"px",this.canvas.style.width=this.canvas.width/this.dpr+"px"}},{key:"initChart",value:function(){var t=this.chart,i=this.controller,e=t.options.logo;e&&(this.logo=new Image,this.logo.src=e,this.highDefinition(),i.registerMouseEvents(),this.draw())}},{key:"resize",value:function(){var t=this.chart;this.service.calcPadding(t.bars),this.chartHeight=this.canvasHeight-this.padding.top-this.padding.bottom,this.chartWidth=this.canvasWidth-this.padding.left-this.padding.right,t.options.hasVolume&&(this.volumeChartHeight=this.chartHeight/3),this.klineChartHeight=this.chartHeight-this.volumeChartHeight,t.domUtils.getDOMElm("#"+A.VOL_INFO_CONTAINER_ID).style="top:".concat((this.canvasHeight-this.volumeChartHeight)/this.dpr,"px")}},{key:"clearCanvas",value:function(){this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight}},{key:"drawLogo",value:function(){var t=348*this.dpr,i=85.5*this.dpr;this.ctx.drawImage(this.logo,this.canvasWidth/2-t/2,this.canvasHeight/2-i/2,t,i)}},{key:"draw",value:function(){var t=this.service,i=this.controller;this.resize(),t.calcDataZoom(t.dataZoom.user?"update":"init"),this.clearCanvas(),this.drawBg(),this.drawAxis(),this.drawMAs(),this.drawTicker(),this.drawTickerInfo(),this.drawLastTickerPrice(),this.drawCursorCross(i.nowMousePosition.x,i.nowMousePosition.y)}},{key:"drawBg",value:function(){var t=this,i=this.chart;this.ctx.beginPath(),this.ctx.fillStyle=i.options.backgroundColor||"#191b20",this.ctx.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.logo&&(this.logo.complete?this.drawLogo():this.logo.onload=function(){t.drawLogo()})}},{key:"drawAxis",value:function(){var t=this.service;t.calcUnitToXAxisPx(),t.calcUnitToYAxisPx(),this.drawXAxis(),this.drawYAxis()}},{key:"drawXAxis",value:function(){var t=this.service,i=this.chart,e=t.calcXAxisCoordinate();this.scaleHeight=5*this.dpr,i.canvasUtils.drawLine({x:this.padding.left,y:this.chartHeight+this.padding.top},{x:this.chartWidth+this.padding.left,y:this.chartHeight+this.padding.top},"#34383F");var r,a=b(e);try{for(a.s();!(r=a.n()).done;){var n=r.value,o=n.x;o>=this.padding.left+this.chartWidth||o<=this.padding.left||(i.canvasUtils.drawLine({x:o,y:this.chartHeight+this.padding.top},{x:o,y:this.chartHeight+this.padding.top+this.scaleHeight},"rgb(132, 142, 156)"),i.canvasUtils.drawLine({x:o,y:this.padding.top},{x:o,y:this.chartHeight+this.padding.top},"#24272C"),this.drawLabels({x:o,y:void 0},n.time))}}catch(t){a.e(t)}finally{a.f()}}},{key:"drawYAxis",value:function(){var t=this,i=this.service,e=this.chart;(e.canvasUtils.drawLine({x:this.padding.left+this.chartWidth,y:this.padding.top},{x:this.padding.left+this.chartWidth,y:this.chartHeight+this.padding.top},"#34383F"),i.calcYAxisCoordinate("kline").forEach((function(i){e.canvasUtils.drawLine({x:t.padding.left+t.chartWidth,y:i.y},{x:t.chartWidth+t.padding.top+t.scaleHeight,y:i.y},"rgb(132, 142, 156)"),e.canvasUtils.drawLine({x:t.padding.left,y:i.y},{x:t.chartWidth+t.padding.left,y:i.y},"#24272C"),t.drawLabels({x:void 0,y:i.y},i.value)})),e.options.hasVolume)&&i.calcYAxisCoordinate("volume").forEach((function(i){e.canvasUtils.drawLine({x:t.padding.left+t.chartWidth,y:i.y},{x:t.chartWidth+t.padding.top+t.scaleHeight,y:i.y},"rgb(132, 142, 156)"),e.canvasUtils.drawLine({x:t.padding.left,y:i.y},{x:t.chartWidth+t.padding.left,y:i.y},"#24272C"),t.drawLabels({x:void 0,y:i.y},i.value)}))}},{key:"drawLabels",value:function(t,i){var e=this.chart,r=i;r=t.x?d("HH:MM",new Date(i)):u(r,e.priceDigitNumber),e.canvasUtils.drawText(t.x||this.padding.left+this.chartWidth+this.scaleHeight,t.y||this.chartHeight+this.padding.top+this.scaleHeight,r,this.axisLabelSize*this.dpr+"px sans-serif",t.x?"top":"middle","rgb(132, 142, 156)",t.x?"center":"left")}},{key:"drawTicker",value:function(){var t=this,i=this.service,e=this.chart;i.dataZoom.realData.forEach((function(i){t.drawCandle(i),e.options.hasVolume&&t.drawVolume(i)}))}},{key:"drawCandle",value:function(t){var i=this.service,e=this.chart;i.formatTickerData(t);var r=t.status,a=i.mapDataToCoordinate(t.time,t.open),n=i.mapDataToCoordinate(t.time,t.close),o=i.mapDataToCoordinate(t.time,t.high),s=i.mapDataToCoordinate(t.time,t.low);this.candleMargin=e.tickerUnit/20/i.unitToXAxisPx,this.candleWidth=e.tickerUnit/i.unitToXAxisPx-2*this.candleMargin;var h="up"===r?n.x-this.candleWidth/2:a.x-this.candleWidth/2,l="up"===r?n.y:a.y,c=Math.abs(n.y-a.y),d=this.candleWidth;if(h+d>=this.padding.left+this.chartWidth)(d=d-(h+d-this.padding.left-this.chartWidth)-2*this.dpr)<0&&(d=0);else if(h<this.padding.left){if(h+d<this.padding.left)return;d-=this.padding.left-h,h=this.padding.left}else e.canvasUtils.drawLine({x:a.x,y:o.y},{x:a.x,y:s.y},_[r]);e.canvasUtils.drawRect(h,l,d,c,_[r])}},{key:"drawVolumes",value:function(){var t=this;this.service.dataZoom.realData.forEach((function(i){return t.drawVolume(i)}))}},{key:"drawVolume",value:function(t){var i=this.service,e=this.chart,r=i.mapDataToCoordinate(t.time,t.volume,"volume"),a=r.x,n=r.y,o=this.candleWidth,s=this.canvasHeight-this.padding.bottom-n,h=a-o/2;if(h+o>=this.padding.left+this.chartWidth)(o=o-(h+o-this.padding.left-this.chartWidth)-2*this.dpr)<0&&(o=0);else if(h<this.padding.left){if(h+o<this.padding.left)return;o-=this.padding.left-h,h=this.padding.left}e.canvasUtils.drawRect(h,n,o,s,_[t.status+"Lowlight"])}},{key:"drawMAs",value:function(){var t=this,i=this.service,e=this.chart;i.calcMAPoints(),e.MAOptions.forEach((function(r){var a=r.points.map((function(t){return i.mapDataToCoordinate(t.time,t.value)}));t.ctx.beginPath();for(var n=0;n<a.length;n++){var o=a[n],s=a[n+1];if(!s)break;o.x<=t.padding.left||s.x>=t.chartWidth+t.padding.left||(o.y>t.padding.top+t.klineChartHeight||s.y>t.padding.top+t.klineChartHeight||e.canvasUtils.drawLine({x:o.x,y:o.y},{x:s.x,y:s.y},r.color,!1))}t.ctx.stroke()}))}},{key:"drawTickerInfo",value:function(){var t=this.chart,i=t.cursorTicker||t.bars[t.bars.length-1];this.drawCandleInfo(i);var e,r={},a=b(t.MAOptions);try{for(a.s();!(e=a.n()).done;){var n=e.value;if(r[n.interval]=n.points.find((function(t){return t.time===i.time})),!r[n.interval])return;r[n.interval].color=n.color}}catch(t){a.e(t)}finally{a.f()}this.drawMAInfo(r),t.options.hasVolume&&this.drawVolumeInfo(i)}},{key:"drawCandleInfo",value:function(t){var i=this.chart,e=i.domUtils;i.domUtils.getDOMElm("#"+A.TIME_SPAN_ID).innerHTML=d("YYYY/mm/dd HH:MM",new Date(t.time));var r=i.domUtils.getDOMElm("#"+A.OPEN_VALUE_ID);r.innerHTML=u(t.open,i.priceDigitNumber),e.setStyle(r,{color:_[t.status]});var a=i.domUtils.getDOMElm("#"+A.LOW_VALUE_ID);a.innerHTML=u(t.low,i.priceDigitNumber),e.setStyle(a,{color:_[t.status]});var n=i.domUtils.getDOMElm("#"+A.CLOSE_VALUE_ID);n.innerHTML=u(t.close,i.priceDigitNumber),e.setStyle(n,{color:_[t.status]});var o=i.domUtils.getDOMElm("#"+A.CHANGE_VALUE_ID);o.innerHTML=u(t.change,2),e.setStyle(o,{color:_[t.status]});var s=i.domUtils.getDOMElm("#"+A.AMPLITUDE_VALUE_ID);s.innerHTML=u(t.amplitude,2),e.setStyle(s,{color:_[t.status]})}},{key:"drawMAInfo",value:function(t){var i=this.chart,e=i.domUtils;for(var r in t){var a=t[r],n=i.domUtils.getDOMElm("#__ma-".concat(r,"__"));n.innerHTML=u(a.value,i.priceDigitNumber),e.setStyle(n,{color:a.color})}}},{key:"drawVolumeInfo",value:function(t){var i=this.chart,e=i.domUtils,r=i.domUtils.getDOMElm("#".concat(A.VOL_VALUE_ID));r.innerHTML=u(t.volume,i.volumeDigitNumer),e.setStyle(r,{color:_[t.status]})}},{key:"drawCursorCross",value:function(t,i){if(t&&i){var e=this.chart,r=this.dpr*t,a=this.dpr*i;r>=this.padding.left+this.chartWidth||a>this.padding.top+this.chartHeight?this.canvas.style.cursor="default":(this.canvas.style.cursor="crosshair",r=this.drawCursorLabel(r,a),e.canvasUtils.drawLine({x:this.padding.left,y:a},{x:this.padding.left+this.chartWidth,y:a},"#AEB4BC",!0,[5*this.dpr,5*this.dpr]),e.canvasUtils.drawLine({x:r,y:this.padding.top},{x:r,y:this.padding.top+this.chartHeight},"#AEB4BC",!0,[5*this.dpr,5*this.dpr]))}}},{key:"drawCursorLabel",value:function(t,i){var e=this.chart,r=this.service,a=r.findTicker(t,i),n=a.ticker,o=a.type;if(e.cursorTicker=n,!n)return t;var s=r.mapDataToCoordinate(n.time,0),h=d("YYYY/mm/dd HH:MM",new Date(n.time)),l=e.canvasUtils.getTextWidthAndHeight(this.axisLabelSize*this.dpr,"sans-serif",h),c=l.width,u=l.height,v=c+15*this.dpr,f=this.padding.bottom;e.canvasUtils.drawRect(s.x-v/2,this.chartHeight+this.padding.top,v,f,"#2B2F36"),e.canvasUtils.drawText(s.x,this.chartHeight+this.padding.top+f/2-u/2,h,this.axisLabelSize*this.dpr+"px sans-serif","top","#fff","center");var p="kline"===o?n.close:n.volume;return this.drawYAxisLabelPolygon(i,"#2B2F36","#3D434C",p,o),s.x}},{key:"drawYAxisLabelPolygon",value:function(t,i,e,r,a){var n=this.chart,o=20*this.dpr,s=this.padding.right,h=[{x:this.padding.left+this.chartWidth,y:t},{x:this.padding.left+this.chartWidth+s/6,y:t-o/2},{x:this.padding.left+this.chartWidth+s,y:t-o/2},{x:this.padding.left+this.chartWidth+s,y:t+o/2},{x:this.padding.left+this.chartWidth+s/6,y:t+o/2}];n.canvasUtils.drawPolygon(h,"fill",i,1*this.dpr),n.canvasUtils.drawPolygon(h,"stroke",e,1*this.dpr),n.canvasUtils.drawText(this.padding.left+this.chartWidth+this.scaleHeight,t,"price"===a?u(r,n.priceDigitNumber):r,12*this.dpr+"px ","middle","#fff","left")}},{key:"drawLastTickerPrice",value:function(){var t=this.service,i=t.dataZoom.data[t.dataZoom.data.length-1],e=t.mapDataToCoordinate(i.time,i.close).y;this.drawYAxisLabelPolygon(e,_[i.status],"up"===i.status?_.upHighlight:_.downHighlight,i.close,"price")}}]),t}();return function(){function t(i){var e;h(this,t),c(this,"view",void 0),c(this,"service",void 0),c(this,"controller",void 0),c(this,"options",void 0),c(this,"bars",void 0),c(this,"container",void 0),c(this,"canvasUtils",void 0),c(this,"domUtils",void 0),c(this,"tickerUnit",void 0),c(this,"cursorTicker",void 0),c(this,"priceDigitNumber",2),c(this,"volumeDigitNumer",3),c(this,"MAOptions",[{color:"#FF00FF",interval:7},{color:"#CF3049",interval:25},{color:"#00CCCC",interval:99}]),c(this,"MAData",void 0),c(this,"maxMAInterval",void 0),this.view=new M,this.service=new w,this.controller=new v,this.inject(),this.options=i,this.container=document.querySelector(this.options.el),this.domUtils=function(t){function i(t,i){var e=document.createElement(t);for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r]);return e}function e(i,e){var r=e||t;Array.isArray(i)?i.forEach((function(t){return r.appendChild(t)})):r.appendChild(i)}return{createElm:i,appendElms:e,setStyle:function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t.style[e]=i[e])},getDOMElm:function(t,r){var a=document.querySelector(t);if(!a){for(var n=arguments.length,o=new Array(n>2?n-2:0),s=2;s<n;s++)o[s-2]=arguments[s];e(a=i.apply(void 0,o),r)}return a}}}(this.container),this.view.createElements(),this.canvasUtils=(e=this.view.ctx,{drawLine:function(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#fff",a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0,0];a&&e.beginPath(),e.setLineDash(n),e.moveTo(t.x,t.y),e.lineTo(i.x,i.y),e.strokeStyle=r,a&&e.stroke()},drawRect:function(t,i,r,a){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"#fff";e.fillStyle=n,e.lineWidth=1,e.beginPath(),e.rect(t,i,r,a),e.fill()},drawPolygon:function(t,i,r,a){e.beginPath(),e.lineWidth=a,e.moveTo(t[0].x,t[0].y),t.forEach((function(t,i){i>=1&&e.lineTo(t.x,t.y)})),e.lineTo(t[0].x,t[0].y),e[i+"Style"]=r,e.closePath(),e[i]()},drawText:function(t,i,r,a,n,o,s){e.font=a,e.textBaseline=n,e.textAlign=s,e.fillStyle=o,e.fillText(r,t,i)},getTextWidthAndHeight:function(t,i,r){return e.font=t+"px "+i,{width:e.measureText(r).width,height:t}}}),i.MA&&(this.MAOptions=i.MA),this.maxMAInterval=Math.max.apply(Math,s(this.MAOptions.map((function(t){return t.interval})))),this.bars=i.bars.sort((function(t,i){return t.time-i.time})),this.options.hasVolume&&(this.options.hasVolume=this.bars.every((function(t){return!!t.volume}))),this.tickerUnit=this.bars[1].time-this.bars[0].time,this.view.initChart()}return l(t,[{key:"inject",value:function(){this.service.inject(this.view,this.controller,this),this.controller.inject(this.view,this.service,this),this.view.inject(this.service,this.controller,this)}},{key:"subscribeBars",value:function(t,i,e){var r=this.bars[this.bars.length-1],a={open:r.open,high:r.high,low:r.low,close:t,volume:r.volume,time:r.time};e-r.time>=this.tickerUnit?(a.open=r.close,a.high=t,a.low=t,a.time=e,a.volume=i,this.bars.push(a)):(t>r.high&&(a.high=t),t<r.low&&(a.low=t),a.volume+=i,this.bars[this.bars.length-1]=a),this.view.draw()}}]),t}()}();
